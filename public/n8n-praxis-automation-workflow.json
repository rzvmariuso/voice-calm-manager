{
  "name": "Praxis AI Termin Automation",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "praxis-booking",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook-trigger",
      "name": "🎯 AI Termin Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [240, 300],
      "webhookId": "ai-booking-webhook"
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{$json.trigger_type}}",
              "operation": "equal",
              "value2": "new_appointment"
            }
          ]
        }
      },
      "id": "check-appointment",
      "name": "✅ Ist Terminbuchung?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [460, 300]
    },
    {
      "parameters": {
        "fromEmail": "praxis@ihredomain.de",
        "toEmail": "={{$json.patient.name}} <{{$json.patient.email || 'test@example.com'}}>",
        "subject": "✅ Ihr Termin bei {{$json.practice.name}} wurde gebucht",
        "text": "",
        "html": "<!DOCTYPE html>\n<html>\n<head>\n<style>\nbody { font-family: Arial, sans-serif; margin: 0; padding: 20px; background-color: #f5f5f5; }\n.container { max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }\n.header { text-align: center; color: #2c5aa0; margin-bottom: 30px; }\n.appointment-details { background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; }\n.detail-row { display: flex; justify-content: space-between; margin: 10px 0; padding: 8px 0; border-bottom: 1px solid #eee; }\n.footer { text-align: center; margin-top: 30px; color: #666; font-size: 14px; }\n</style>\n</head>\n<body>\n<div class=\"container\">\n  <div class=\"header\">\n    <h1>🎉 Termin bestätigt!</h1>\n    <p>Liebe/r {{$json.patient.name}},</p>\n  </div>\n  \n  <p>vielen Dank für Ihre Terminbuchung! Wir freuen uns auf Ihren Besuch.</p>\n  \n  <div class=\"appointment-details\">\n    <h3>📅 Ihre Termindetails:</h3>\n    <div class=\"detail-row\">\n      <strong>Datum:</strong>\n      <span>{{$json.appointment.date}}</span>\n    </div>\n    <div class=\"detail-row\">\n      <strong>Uhrzeit:</strong>\n      <span>{{$json.appointment.time}} Uhr</span>\n    </div>\n    <div class=\"detail-row\">\n      <strong>Behandlung:</strong>\n      <span>{{$json.appointment.service}}</span>\n    </div>\n    <div class=\"detail-row\">\n      <strong>Dauer:</strong>\n      <span>ca. 45-60 Minuten</span>\n    </div>\n  </div>\n  \n  <h3>📍 Praxisadresse:</h3>\n  <p>\n    <strong>{{$json.practice.name}}</strong><br>\n    Musterstraße 123<br>\n    12345 Musterstadt<br>\n    Tel: {{$json.practice.phone}}\n  </p>\n  \n  <h3>💡 Wichtige Hinweise:</h3>\n  <ul>\n    <li>Bitte kommen Sie 10 Minuten vor Ihrem Termin</li>\n    <li>Bringen Sie bequeme Kleidung mit</li>\n    <li>Bei Verhinderung mindestens 24h vorher absagen</li>\n  </ul>\n  \n  <div class=\"footer\">\n    <p>Haben Sie Fragen? Rufen Sie uns gerne an: {{$json.practice.phone}}</p>\n    <p><em>Diese Bestätigung wurde automatisch generiert.</em></p>\n  </div>\n</div>\n</body>\n</html>",
        "options": {}
      },
      "id": "send-confirmation-email",
      "name": "📧 Bestätigungs-Email",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2,
      "position": [680, 200]
    },
    {
      "parameters": {
        "operation": "create",
        "calendarId": "primary",
        "start": "={{$json.appointment.date}}T{{$json.appointment.time}}:00",
        "end": "={{$json.appointment.date}}T{{new Date(new Date('2000-01-01T' + $json.appointment.time + ':00').getTime() + 60*60*1000).toTimeString().substr(0,5)}}:00",
        "summary": "{{$json.appointment.service}} - {{$json.patient.name}}",
        "description": "Patient: {{$json.patient.name}}\\nTelefon: {{$json.patient.phone}}\\nBehandlung: {{$json.appointment.service}}\\n\\nAutomatisch gebucht über AI-Agent",
        "location": "{{$json.practice.name}}",
        "attendees": []
      },
      "id": "create-calendar-event",
      "name": "📅 Google Calendar",
      "type": "n8n-nodes-base.googleCalendar",
      "typeVersion": 1,
      "position": [680, 300]
    },
    {
      "parameters": {
        "channel": "#termine",
        "text": "🎉 *Neuer Termin gebucht!*\\n\\n👤 *Patient:* {{$json.patient.name}}\\n📞 *Telefon:* {{$json.patient.phone}}\\n📅 *Datum:* {{$json.appointment.date}}\\n🕐 *Zeit:* {{$json.appointment.time}} Uhr\\n💆 *Behandlung:* {{$json.appointment.service}}\\n\\n_Automatisch gebucht über AI-Agent_ 🤖",
        "otherOptions": {}
      },
      "id": "slack-notification",
      "name": "💬 Slack Team Info",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 1,
      "position": [680, 400]
    },
    {
      "parameters": {
        "accountSid": "={{ $credentials.twilioApi.accountSid }}",
        "fromPhoneNumber": "+491234567890",
        "toPhoneNumber": "={{$json.patient.phone}}",
        "message": "Hallo {{$json.patient.name}}! 👋\\n\\nIhr Termin bei {{$json.practice.name}} ist bestätigt:\\n📅 {{$json.appointment.date}} um {{$json.appointment.time}} Uhr\\n💆 {{$json.appointment.service}}\\n\\nWir freuen uns auf Sie!\\n\\nIhre {{$json.practice.name}}",
        "options": {}
      },
      "id": "send-sms",
      "name": "📱 SMS Bestätigung",
      "type": "n8n-nodes-base.twilio",
      "typeVersion": 1,
      "position": [680, 500]
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineAll",
        "options": {}
      },
      "id": "wait-for-all",
      "name": "⏳ Warten auf alle",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2,
      "position": [900, 350]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "{\n  \"success\": true,\n  \"message\": \"Automation erfolgreich ausgeführt\",\n  \"patient\": \"{{$json.patient.name}}\",\n  \"appointment\": \"{{$json.appointment.date}} {{$json.appointment.time}}\",\n  \"actions_completed\": [\n    \"email_sent\",\n    \"calendar_created\",\n    \"team_notified\",\n    \"sms_sent\"\n  ]\n}"
      },
      "id": "webhook-response",
      "name": "✅ Erfolgreich",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1120, 350]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "{\n  \"success\": false,\n  \"message\": \"Kein gültiger Terminbuchungs-Trigger\",\n  \"received_type\": \"{{$json.trigger_type}}\"\n}"
      },
      "id": "webhook-error",
      "name": "❌ Kein Termin",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [680, 600]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "-- Logging des verarbeiteten Termins für Statistiken\\nINSERT INTO automation_logs (\\n  practice_id, \\n  appointment_id, \\n  trigger_type, \\n  actions_completed,\\n  created_at\\n) VALUES (\\n  '{{$json.practice.id}}',\\n  '{{$json.appointment.id}}',\\n  '{{$json.trigger_type}}',\\n  '[\"email\", \"calendar\", \"slack\", \"sms\"]',\\n  NOW()\\n);",
        "additionalFields": {}
      },
      "id": "log-automation",
      "name": "📊 Automation Logger",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 1,
      "position": [900, 500]
    }
  ],
  "connections": {
    "🎯 AI Termin Webhook": {
      "main": [
        [
          {
            "node": "✅ Ist Terminbuchung?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "✅ Ist Terminbuchung?": {
      "main": [
        [
          {
            "node": "📧 Bestätigungs-Email",
            "type": "main",
            "index": 0
          },
          {
            "node": "📅 Google Calendar",
            "type": "main",
            "index": 0
          },
          {
            "node": "💬 Slack Team Info",
            "type": "main",
            "index": 0
          },
          {
            "node": "📱 SMS Bestätigung",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "❌ Kein Termin",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "📧 Bestätigungs-Email": {
      "main": [
        [
          {
            "node": "⏳ Warten auf alle",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "📅 Google Calendar": {
      "main": [
        [
          {
            "node": "⏳ Warten auf alle",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "💬 Slack Team Info": {
      "main": [
        [
          {
            "node": "⏳ Warten auf alle",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "📱 SMS Bestätigung": {
      "main": [
        [
          {
            "node": "⏳ Warten auf alle",
            "type": "main",
            "index": 3
          },
          {
            "node": "📊 Automation Logger",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "⏳ Warten auf alle": {
      "main": [
        [
          {
            "node": "✅ Erfolgreich",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "timezone": "Europe/Berlin"
  },
  "createdAt": "2024-01-02T10:00:00.000Z",
  "updatedAt": "2024-01-02T10:00:00.000Z",
  "id": "praxis-ai-automation",
  "tags": [
    {
      "createdAt": "2024-01-02T10:00:00.000Z",
      "updatedAt": "2024-01-02T10:00:00.000Z",
      "id": "praxis-automation",
      "name": "Praxis Automation"
    }
  ]
}